<!--
IMPORTANTE: Ao salvar este c√≥digo em um arquivo .html, certifique-se de que
a codifica√ß√£o do arquivo seja "UTF-8". No Bloco de Notas (Windows), por exemplo,
na janela "Salvar como", existe uma op√ß√£o "Codifica√ß√£o" na parte inferior.
Selecione "UTF-8" para garantir que os acentos apare√ßam corretamente.
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio de Comportamentos Aut√≠sticos (ICA)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto max-w-4xl my-10 p-8 bg-white rounded-2xl shadow-lg">
        <!-- Cabe√ßalho -->
        <header class="text-center p-6 bg-gray-50 rounded-xl mb-8 border border-gray-200">
            <h2 class="text-xl font-bold text-gray-700">Psic√≥logo Respons√°vel: Fanuel Candido Glanzmann ‚Äì CRP 05/63951</h2>
            <p class="text-gray-600 mt-2"><strong>Abordagem:</strong> Terapia Cognitivo-Comportamental (TCC)</p>
            <p class="text-gray-600"><strong>Servi√ßo:</strong> Avalia√ß√£o Psicol√≥gica / Teste Psicom√©trico</p>
            <div class="mt-3 text-sm text-blue-600 space-x-4">
                <a href="http://psifanuel.com.br" target="_blank" class="hover:underline">psifanuel.com.br</a>
                <span>|</span>
                <a href="mailto:psifanuel@gmail.com" class="hover:underline">psifanuel@gmail.com</a>
                <span>|</span>
                <a href="https://wa.me/5524988378145" target="_blank" class="hover:underline">WhatsApp: +55 (24) 98837-8145</a>
            </div>
        </header>

        <main>
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">Invent√°rio de Comportamentos Aut√≠sticos (ICA)</h1>
            <p class="text-center text-gray-500 mb-8">Vers√£o para M√£e de Adulto</p>

            <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 mb-8 rounded-md">
                <p class="font-bold">Instru√ß√µes:</p>
                <p>Leia atentamente cada item e assinale se o comportamento descrito ainda √© observado ou foi observado com frequ√™ncia durante a inf√¢ncia/adolesc√™ncia de seu filho.</p>
            </div>

            <form id="ica-form">
                <!-- Se√ß√£o de Identifica√ß√£o -->
                <div class="mb-8 p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Identifica√ß√£o</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="nome_filho" class="block text-sm font-medium text-gray-700">Nome do filho:</label>
                            <input type="text" id="nome_filho" name="nome_filho" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="data_aplicacao" class="block text-sm font-medium text-gray-700">Data da aplica√ß√£o:</label>
                            <input type="date" id="data_aplicacao" name="data_aplicacao" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="idade_atual" class="block text-sm font-medium text-gray-700">Idade atual:</label>
                            <input type="text" id="idade_atual" name="idade_atual" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="data_nascimento" class="block text-sm font-medium text-gray-700">Data de nascimento:</label>
                            <input type="date" id="data_nascimento" name="data_nascimento" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o do Question√°rio -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Question√°rio</h3>
                    <ol class="space-y-3" id="questions-list">
                        <!-- As perguntas ser√£o inseridas aqui pelo JavaScript -->
                    </ol>
                </div>

                <!-- Se√ß√£o de Pontua√ß√£o -->
                <div class="p-6 border border-gray-200 rounded-lg bg-gray-50">
                    <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">Pontua√ß√£o por Dom√≠nio</h3>
                    <div class="flex justify-center items-center flex-wrap gap-4 text-center">
                        <div>
                            <label for="score_es" class="block text-sm font-medium text-gray-700">ES</label>
                            <input type="text" id="score_es" name="score_es" readonly class="mt-1 w-16 text-center bg-white border border-gray-300 rounded-md shadow-sm font-bold text-lg">
                        </div>
                        <div>
                            <label for="score_re" class="block text-sm font-medium text-gray-700">RE</label>
                            <input type="text" id="score_re" name="score_re" readonly class="mt-1 w-16 text-center bg-white border border-gray-300 rounded-md shadow-sm font-bold text-lg">
                        </div>
                        <div>
                            <label for="score_co" class="block text-sm font-medium text-gray-700">CO</label>
                            <input type="text" id="score_co" name="score_co" readonly class="mt-1 w-16 text-center bg-white border border-gray-300 rounded-md shadow-sm font-bold text-lg">
                        </div>
                        <div>
                            <label for="score_lg" class="block text-sm font-medium text-gray-700">LG</label>
                            <input type="text" id="score_lg" name="score_lg" readonly class="mt-1 w-16 text-center bg-white border border-gray-300 rounded-md shadow-sm font-bold text-lg">
                        </div>
                        <div>
                            <label for="score_ps" class="block text-sm font-medium text-gray-700">PS</label>
                            <input type="text" id="score_ps" name="score_ps" readonly class="mt-1 w-16 text-center bg-white border border-gray-300 rounded-md shadow-sm font-bold text-lg">
                        </div>
                        <div class="text-blue-600">
                            <label for="score_total" class="block text-sm font-bold">Total</label>
                            <input type="text" id="score_total" name="score_total" readonly class="mt-1 w-20 text-center bg-blue-100 border border-blue-300 rounded-md shadow-sm font-bold text-xl">
                        </div>
                    </div>
                </div>
            </form>

             <!-- Bot√µes de A√ß√£o -->
            <div id="action-buttons" class="mt-10 pt-6 border-t border-gray-200 flex flex-col sm:flex-row justify-center gap-4">
                <button id="save-cloud" type="button" class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:bg-gray-400">
                    Salvar na Nuvem
                </button>
                <button id="save-json" type="button" class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    Salvar em JSON
                </button>
                <button id="send-whatsapp" type="button" class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Enviar por WhatsApp
                </button>
                <button id="send-email" type="button" class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Enviar por E-mail
                </button>
            </div>
        </main>

        <!-- Rodap√© -->
        <footer class="text-center mt-10 pt-6 border-t border-gray-200">
            <p class="font-bold text-gray-600">üì∏ Direitos de Imagem e Confidencialidade</p>
            <p class="text-xs text-gray-500 mt-2 max-w-2xl mx-auto">
                As imagens, registros e dados coletados durante esta avalia√ß√£o s√£o de uso exclusivo do psic√≥logo respons√°vel e destinam-se exclusivamente aos fins cl√≠nicos e cient√≠ficos pertinentes √† avalia√ß√£o psicol√≥gica.
            </p>
            <p class="text-xs text-gray-500 mt-1 max-w-2xl mx-auto">
                √â vedada a reprodu√ß√£o, divulga√ß√£o ou compartilhamento parcial ou integral deste material sem autoriza√ß√£o expressa do profissional e do avaliado, conforme o C√≥digo de √âtica Profissional do Psic√≥logo (Resolu√ß√£o CFP n¬∫ 010/2005).
            </p>
        </footer>
    </div>

    <script type="module">
        // Importa a fun√ß√£o de salvamento do nosso servi√ßo
        import { saveTestResult } from './firestore-service.js';

        document.addEventListener('DOMContentLoaded', function() {
            const questions = [
                { text: "Gira ou girava em torno de si por longos per√≠odos de tempo.", domain: "ES" },
                { text: "Aprende tarefas, mas esquece com facilidade.", domain: "CO" },
                { text: "Costuma ignorar express√µes faciais, gestos ou situa√ß√µes sociais.", domain: "RE" },
                { text: "N√£o responde (ou n√£o respondia) a solicita√ß√µes verbais simples, como 'venha c√°' ou 'sente-se'.", domain: "LG" },
                { text: "Usa ou usava objetos de maneira repetitiva ou incomum (ex: girar, empilhar).", domain: "CO" },
                { text: "Fixa ou fixava o olhar em detalhes de objetos, sem perceber o todo.", domain: "ES" },
                { text: "Raramente sorri ou sorria em resposta a intera√ß√µes sociais.", domain: "RE" },
                { text: "Usa ou usava pronomes de forma trocada (ex: dizer 'ele' em vez de 'eu').", domain: "LG" },
                { text: "Insiste ou insistia em manter certos objetos consigo.", domain: "CO" },
                { text: "Costuma parecer que n√£o est√° ou estava escutando, mesmo quando chamado.", domain: "ES" },
                { text: "Fala ou falava de forma mon√≥tona, sem varia√ß√µes de ritmo ou entona√ß√£o.", domain: "LG" },
                { text: "Fica ou ficava balan√ßando o corpo por longos per√≠odos.", domain: "ES" },
                { text: "N√£o estende ou n√£o estendia os bra√ßos para ser pego (nem quando era beb√™).", domain: "RE" },
                { text: "Reage ou reagia fortemente a mudan√ßas no ambiente.", domain: "RE" },
                { text: "Ignora ou ignorava seu nome mesmo quando outras crian√ßas reagiam.", domain: "RE" },
                { text: "Corre ou corria girando sobre si, balan√ßando as m√£os ou fazendo movimentos repetitivos.", domain: "ES" },
                { text: "N√£o reconhece ou n√£o reconhecia express√µes faciais ou sentimentos de outras pessoas.", domain: "RE" },
                { text: "Raramente usa ou usava palavras como 'sim' ou 'eu'.", domain: "LG" },
                { text: "Demonstra habilidade not√°vel em alguma √°rea espec√≠fica.", domain: "PS" },
                { text: "N√£o compreende ou compreendia comandos verbais com refer√™ncias espaciais (ex: 'coloque ao lado').", domain: "LG" },
                { text: "Assusta-se ou assustava-se com sons altos, parecendo surdez.", domain: "ES" },
                { text: "Balan√ßa ou balan√ßava frequentemente as m√£os.", domain: "ES" },
                { text: "Tem ou tinha explos√µes de raiva frequentes ou 'chiliques'.", domain: "RE" },
                { text: "Evita ou evitava ativamente o contato visual.", domain: "RE" },
                { text: "Resiste ou resistia ao toque, ao colo ou ao carinho.", domain: "RE" },
                { text: "N√£o reage ou n√£o reagia a est√≠mulos dolorosos como cortes ou quedas.", domain: "ES" },
                { text: "Fica ou ficava r√≠gido quando est√°/estava no colo (ou era assim quando beb√™).", domain: "RE" },
                { text: "Fica ou ficava fl√°cido quando est√°/estava no colo.", domain: "RE" },
                { text: "Aponta ou apontava para indicar o que deseja.", domain: "LG" },
                { text: "Anda ou andava frequentemente nas pontas dos p√©s.", domain: "CO" },
                { text: "Aglide ou agredia outras pessoas mordendo, batendo etc.", domain: "RE" },
                { text: "Repete ou repetia a mesma frase v√°rias vezes.", domain: "LG" },
                { text: "N√£o imita ou n√£o imitava brincadeiras de outras crian√ßas.", domain: "RE" },
                { text: "N√£o pisca ou n√£o piscava quando luz forte incide em seus olhos.", domain: "ES" },
                { text: "Machuca ou machucava a si mesmo (mordendo, batendo a cabe√ßa etc.).", domain: "ES" },
                { text: "N√£o sabe ou n√£o sabia esperar para ser atendido; quer tudo imediatamente.", domain: "PS" },
                { text: "N√£o aponta ou n√£o apontava para mais que cinco objetos diferentes.", domain: "LG" },
                { text: "Tem ou tinha dificuldade para fazer amizades.", domain: "RE" },
                { text: "Tapa ou tapava os ouvidos para diversos sons.", domain: "ES" },
                { text: "Gira ou girava objetos repetidamente ou os bate v√°rias vezes.", domain: "CO" },
                { text: "Teve dificuldade para aprender a usar o banheiro.", domain: "PS" },
                { text: "Usa ou usava poucas palavras por dia para expressar necessidades.", domain: "LG" },
                { text: "√â ou era muito ansioso ou medroso.", domain: "PS" },
                { text: "Franze, cobre ou vira os olhos quando em presen√ßa de luz natural.", domain: "ES" },
                { text: "N√£o se veste ou n√£o se vestia sem ajuda.", domain: "PS" },
                { text: "Repete ou repetia frequentemente as mesmas palavras e/ou sons.", domain: "LG" },
                { text: "Olha ou olhava como se estivesse 'atravessando' as pessoas com o olhar.", domain: "RE" },
                { text: "Repete ou repetia perguntas ou frases ditas por outros (ecolalia).", domain: "LG" },
                { text: "Parece ou parecia inconsciente dos perigos ao redor.", domain: "PS" },
                { text: "Prefere ou preferia manipular objetos do que interagir com pessoas.", domain: "CO" },
                { text: "Toca, cheira ou lambe objetos do ambiente.", domain: "ES" },
                { text: "N√£o reage ou n√£o reagia visualmente √† presen√ßa de novas pessoas.", domain: "RE" },
                { text: "Repete ou repetia sequ√™ncias complexas de a√ß√µes (ex: cobrir objetos).", domain: "CO" },
                { text: "Destr√≥i ou destru√≠a brinquedos ou objetos da casa.", domain: "CO" },
                { text: "Apresentou atraso no desenvolvimento identificado antes dos 30 meses de idade.", domain: "PS" },
                { text: "Usa entre 15 e 30 frases por dia para se comunicar.", domain: "LG" },
                { text: "Fixa o olhar em pontos do ambiente por longos per√≠odos.", domain: "ES" }
            ];

            const questionsList = document.getElementById('questions-list');
            const form = document.getElementById('ica-form');

            questions.forEach((q, index) => {
                const li = document.createElement('li');
                li.className = 'bg-gray-50 p-4 border border-gray-200 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center gap-4';

                li.innerHTML = `
                    <span class="question-text flex-grow text-gray-700">
                        <span class="font-semibold">${index + 1}.</span> ${q.text}
                        <span class="text-xs font-mono bg-gray-200 text-gray-600 rounded-full px-2 py-1 ml-2">${q.domain}</span>
                    </span>
                    <div class="options flex-shrink-0 flex items-center gap-x-6">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="q${index + 1}" value="sim" data-domain="${q.domain}" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span>Sim</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="q${index + 1}" value="nao" data-domain="${q.domain}" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                            <span>N√£o</span>
                        </label>
                    </div>
                `;
                questionsList.appendChild(li);
            });

            function calculateScores() {
                const scores = { ES: 0, RE: 0, CO: 0, LG: 0, PS: 0 };
                let totalScore = 0;

                const checkedSim = form.querySelectorAll('input[type="radio"][value="sim"]:checked');

                checkedSim.forEach(radio => {
                    const domain = radio.dataset.domain;
                    if (scores.hasOwnProperty(domain)) {
                        scores[domain]++;
                    }
                });

                document.getElementById('score_es').value = scores.ES;
                document.getElementById('score_re').value = scores.RE;
                document.getElementById('score_co').value = scores.CO;
                document.getElementById('score_lg').value = scores.LG;
                document.getElementById('score_ps').value = scores.PS;

                totalScore = scores.ES + scores.RE + scores.CO + scores.LG + scores.PS;
                document.getElementById('score_total').value = totalScore;
            }

            function getFormDataAsObject() {
                const formData = new FormData(form);
                const data = {};

                data.identificacao = {
                    nome_filho: formData.get('nome_filho'),
                    data_aplicacao: formData.get('data_aplicacao'),
                    idade_atual: formData.get('idade_atual'),
                    data_nascimento: formData.get('data_nascimento')
                };

                data.pontuacao = {
                    es: document.getElementById('score_es').value,
                    re: document.getElementById('score_re').value,
                    co: document.getElementById('score_co').value,
                    lg: document.getElementById('score_lg').value,
                    ps: document.getElementById('score_ps').value,
                    total: document.getElementById('score_total').value
                };

                data.respostas = [];
                questions.forEach((q, index) => {
                    const answer = formData.get(`q${index + 1}`);
                    data.respostas.push({
                        pergunta: `${index + 1}. ${q.text}`,
                        dominio: q.domain,
                        resposta: answer || 'N√£o respondido'
                    });
                });
                return data;
            }

            form.addEventListener('change', calculateScores);
            calculateScores(); // Initial calculation

            // Event Listeners for action buttons
            document.getElementById('save-json').addEventListener('click', () => {
                const data = getFormDataAsObject();
                const nomeFilho = (data.identificacao.nome_filho || 'resultado').replace(/\s+/g, '_');
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ICA_${nomeFilho}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            document.getElementById('send-whatsapp').addEventListener('click', () => {
                const data = getFormDataAsObject();
                const nomeFilho = data.identificacao.nome_filho || 'N√£o preenchido';
                const scores = data.pontuacao;
                let message = `*Resultados do Teste ICA para: ${nomeFilho}*\n\n`;
                message += `*Pontua√ß√£o por Dom√≠nio:*\n`;
                message += `ES: ${scores.es}\n`;
                message += `RE: ${scores.re}\n`;
                message += `CO: ${scores.co}\n`;
                message += `LG: ${scores.lg}\n`;
                message += `PS: ${scores.ps}\n\n`;
                message += `*Total: ${scores.total}*`;

                const whatsappUrl = `https://api.whatsapp.com/send?phone=5524988378145&text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
            });

            document.getElementById('send-email').addEventListener('click', () => {
                const data = getFormDataAsObject();
                const nomeFilho = data.identificacao.nome_filho || 'N√£o preenchido';
                const scores = data.pontuacao;

                const subject = `Resultados do Teste ICA - ${nomeFilho}`;
                let body = `Ol√°,\n\nSeguem os resultados do Invent√°rio de Comportamentos Aut√≠sticos (ICA) para ${nomeFilho}.\n\n`;
                body += `== DADOS DE IDENTIFICA√á√ÉO ==\n`;
                body += `Data da aplica√ß√£o: ${data.identificacao.data_aplicacao || 'N/A'}\n`;
                body += `Idade atual: ${data.identificacao.idade_atual || 'N/A'}\n\n`;
                body += `== PONTUA√á√ÉO POR DOM√çNIO ==\n`;
                body += `ES: ${scores.es}\n`;
                body += `RE: ${scores.re}\n`;
                body += `CO: ${scores.co}\n`;
                body += `LG: ${scores.lg}\n`;
                body += `PS: ${scores.ps}\n\n`;
                body += `PONTUA√á√ÉO TOTAL: ${scores.total}\n\n`;
                body += `Atenciosamente.`;

                const emailUrl = `mailto:psifanuel@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = emailUrl;
            });

            // --- L√≥gica para salvar na nuvem ---
            const saveCloudBtn = document.getElementById('save-cloud');
            saveCloudBtn.addEventListener('click', async () => {
                const nomeFilho = document.getElementById('nome_filho').value;
                if (!nomeFilho) {
                    alert('Por favor, preencha o nome do filho antes de salvar.');
                    return;
                }

                saveCloudBtn.disabled = true;
                saveCloudBtn.textContent = 'Salvando...';

                try {
                    const data = getFormDataAsObject();
                    const docId = await saveTestResult('ICA', data);
                    alert(`Resultado salvo com sucesso na nuvem! ID: ${docId}`);
                    saveCloudBtn.textContent = 'Salvo com Sucesso!';
                    saveCloudBtn.classList.replace('bg-purple-600', 'bg-green-600');
                } catch (error) {
                    console.error("Falha ao salvar:", error);
                    alert(error.message || 'Ocorreu um erro ao salvar os dados.');
                    saveCloudBtn.disabled = false;
                    saveCloudBtn.textContent = 'Salvar na Nuvem';
                }
            });
        });
    </script>
</body>
</html>
