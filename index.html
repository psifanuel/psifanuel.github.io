<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Instrumentos Psicológicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .tag-chip {
            transition: all 0.2s ease-in-out;
        }
        .tag-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .modal-hidden .modal-content {
            transform: translateY(-50px);
            opacity: 0;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-brain text-2xl text-cyan-600"></i>
                <h1 class="text-xl font-bold text-gray-800">Psy-Catálogo</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-gray-600 hover:text-cyan-600">
                    <i class="fas fa-star"></i> <span class="hidden md:inline">Favoritos</span>
                </button>
                 <button class="text-gray-600 hover:text-cyan-600">
                    <i class="fas fa-user-circle"></i> <span class="hidden md:inline">Minha Conta</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Filters Sidebar -->
            <aside class="w-full lg:w-1/4 xl:w-1/5">
                <div class="bg-white p-5 rounded-lg shadow-sm sticky top-24">
                    <h2 class="text-lg font-semibold mb-4 border-b pb-2">Filtros</h2>
                    
                    <!-- Search -->
                    <div class="mb-5">
                        <label for="search" class="sr-only">Buscar</label>
                        <div class="relative">
                            <input type="text" id="search" placeholder="Buscar por título, autor..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Tags Filter -->
                    <div class="mb-5">
                        <h3 class="font-semibold mb-2">Tags</h3>
                        <div id="tags-filter" class="max-h-60 overflow-y-auto pr-2 space-y-2">
                            <!-- Tags will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- Type Filter -->
                    <div class="mb-5">
                        <h3 class="font-semibold mb-2">Tipo</h3>
                        <select id="type-filter" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="all">Todos</option>
                            <option value="Screening">Screening</option>
                            <option value="Escala">Escala</option>
                            <option value="Anamnese">Anamnese</option>
                            <option value="Questionário">Questionário</option>
                        </select>
                    </div>

                    <!-- Access Level Filter -->
                    <div class="mb-5">
                        <h3 class="font-semibold mb-2">Acesso</h3>
                        <select id="access-filter" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="all">Todos</option>
                            <option value="Público">Público</option>
                            <option value="Restrito">Restrito</option>
                        </select>
                    </div>

                    <button id="clear-filters" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-times-circle mr-2"></i>Limpar Filtros
                    </button>
                </div>
            </aside>

            <!-- Results Area -->
            <section class="w-full lg:w-3/4 xl:w-4/5">
                <!-- Sorting and Count -->
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-3 rounded-lg shadow-sm">
                    <p id="item-count" class="text-gray-600 mb-3 md:mb-0">Carregando...</p>
                    <div class="flex items-center">
                        <label for="sort-by" class="mr-2 text-gray-600">Ordenar por:</label>
                        <select id="sort-by" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="recent">Mais Recentes</option>
                            <option value="popular">Mais Usados</option>
                            <option value="time-asc">Tempo (curto → longo)</option>
                            <option value="time-desc">Tempo (longo → curto)</option>
                            <option value="alpha-asc">A-Z</option>
                            <option value="alpha-desc">Z-A</option>
                        </select>
                    </div>
                </div>
                
                <!-- Items Grid -->
                <div id="items-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Item cards will be dynamically inserted here -->
                </div>
                <div id="no-results" class="hidden text-center py-10">
                    <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                    <p class="text-xl text-gray-500">Nenhum instrumento encontrado.</p>
                    <p class="text-gray-400">Tente ajustar seus filtros de busca.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal -->
    <div id="item-modal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center p-4 modal-hidden hidden">
        <div class="modal-content bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b">
                <h2 id="modal-title" class="text-2xl font-bold text-gray-800">Título do Instrumento</h2>
                <button id="modal-close" class="text-gray-500 hover:text-red-500 text-2xl">&times;</button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                    <div class="bg-gray-50 p-3 rounded-lg"><i class="fas fa-user-edit mr-2 text-cyan-600"></i><strong>Autor:</strong> <span id="modal-author"></span></div>
                    <div class="bg-gray-50 p-3 rounded-lg"><i class="fas fa-tag mr-2 text-cyan-600"></i><strong>Tipo:</strong> <span id="modal-type"></span></div>
                    <div class="bg-gray-50 p-3 rounded-lg"><i class="fas fa-clock mr-2 text-cyan-600"></i><strong>Tempo Estimado:</strong> <span id="modal-time"></span></div>
                    <div class="bg-gray-50 p-3 rounded-lg"><i class="fas fa-lock mr-2 text-cyan-600"></i><strong>Acesso:</strong> <span id="modal-access"></span></div>
                </div>

                <div class="mb-4">
                    <h3 class="font-semibold text-lg mb-2">Descrição</h3>
                    <p id="modal-description" class="text-gray-600"></p>
                </div>

                <div class="mb-4">
                    <h3 class="font-semibold text-lg mb-2">Instruções de Aplicação</h3>
                    <p id="modal-instructions" class="text-gray-600"></p>
                </div>
                
                 <div class="mb-4">
                    <h3 class="font-semibold text-lg mb-2">Público-Alvo</h3>
                    <p id="modal-target" class="text-gray-600"></p>
                </div>

                <div>
                    <h3 class="font-semibold text-lg mb-2">Tags</h3>
                    <div id="modal-tags" class="flex flex-wrap gap-2">
                        <!-- Modal tags here -->
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex flex-wrap justify-end items-center gap-3 p-5 border-t mt-auto bg-gray-50">
                <button id="modal-favorite-btn" class="flex items-center px-4 py-2 bg-white border border-yellow-400 text-yellow-500 rounded-lg hover:bg-yellow-50 transition">
                    <i class="far fa-star mr-2"></i><span class="favorite-text">Favoritar</span>
                </button>
                <button id="modal-copy-link-btn" class="flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                    <i class="fas fa-copy mr-2"></i>Copiar Link
                </button>
                <a id="modal-open-link-btn" href="#" target="_blank" class="flex items-center px-6 py-2 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 transition shadow-sm">
                    Abrir Teste <i class="fas fa-external-link-alt ml-2"></i>
                </a>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DADOS DE EXEMPLO ---
            // Em uma aplicação real, estes dados viriam de uma API (Backend)
            const instrumentos = [
                { id: 1, title: "Escala Beck de Depressão (BDI-II)", description: "Avalia a intensidade dos sintomas depressivos em adultos e adolescentes.", tags: ["depressão", "adultos", "rastreio", "clínica"], author: "Aaron T. Beck", type: "Escala", accessLevel: "Restrito", language: "Português", time: 10, version: "2.0", createdAt: "2023-10-26", popularity: 120, link: "#" },
                { id: 2, title: "Inventário de Ansiedade Traço-Estado (IDATE)", description: "Mede dois conceitos distintos de ansiedade: traço e estado.", tags: ["ansiedade", "adultos", "avaliação"], author: "Spielberger, Gorsuch & Lushene", type: "Escala", accessLevel: "Restrito", language: "Português", time: 15, version: "1.1", createdAt: "2023-09-15", popularity: 95, link: "#" },
                { id: 3, title: "Questionário de Saúde Geral (QSG-12)", description: "Instrumento de rastreio para transtornos mentais não-psicóticos.", tags: ["rastreio", "saúde mental", "triagem"], author: "David Goldberg", type: "Screening", accessLevel: "Público", language: "Português", time: 5, version: "1.0", createdAt: "2024-01-10", popularity: 250, link: "#" },
                { id: 4, title: "Anamnese Infantil Completa", description: "Modelo de formulário para coleta de dados na avaliação infantil.", tags: ["infantil", "anamnese", "clínica"], author: "Comunidade Psy", type: "Anamnese", accessLevel: "Público", language: "Português", time: 45, version: "3.2", createdAt: "2022-11-20", popularity: 180, link: "#" },
                { id: 5, title: "Escala de Estresse Percebido (PSS)", description: "Mede o grau em que as situações na vida de uma pessoa são avaliadas como estressantes.", tags: ["estresse", "adultos", "avaliação"], author: "Sheldon Cohen", type: "Escala", accessLevel: "Público", language: "Português", time: 8, version: "1.0", createdAt: "2023-05-01", popularity: 155, link: "#" },
                { id: 6, title: "Inventário de Habilidades Sociais (IHS-Del-Prette)", description: "Avalia o repertório de habilidades sociais em diferentes contextos.", tags: ["habilidades sociais", "avaliação", "jovens", "adultos"], author: "Zilda & Almir Del Prette", type: "Questionário", accessLevel: "Restrito", language: "Português", time: 25, version: "2.1", createdAt: "2023-08-19", popularity: 75, link: "#" },
                { id: 7, title: "PHQ-9: Questionário de Saúde do Paciente", description: "Instrumento para rastreamento e monitoramento da gravidade da depressão.", tags: ["depressão", "rastreio", "saúde primária"], author: "Spitzer, Kroenke & Williams", type: "Screening", accessLevel: "Público", language: "Português", time: 5, version: "1.0", createdAt: "2024-02-01", popularity: 310, link: "#" },
                { id: 8, title: "Escala de Autoestima de Rosenberg", description: "Mede a autoestima global e sentimentos de autoaceitação.", tags: ["autoestima", "adultos", "jovens", "avaliação"], author: "Morris Rosenberg", type: "Escala", accessLevel: "Público", language: "Português", time: 5, version: "1.0", createdAt: "2023-03-22", popularity: 280, link: "#" },
                { id: 9, title: "Conners' Adult ADHD Rating Scales (CAARS)", description: "Escalas para avaliação de TDAH em adultos.", tags: ["TDAH", "adultos", "diagnóstico"], author: "C. Keith Conners", type: "Escala", accessLevel: "Restrito", language: "Inglês", time: 20, version: "1.0", createdAt: "2023-11-30", popularity: 60, link: "#" },
                { id: 10, title: "Formulário de Consentimento Informado", description: "Modelo padrão de termo de consentimento livre e esclarecido (TCLE).", tags: ["ética", "documento", "clínica"], author: "Conselho Federal de Psicologia", type: "Anamnese", accessLevel: "Público", language: "Português", time: 3, version: "2023.1", createdAt: "2023-01-01", popularity: 400, link: "#" },
                { id: 11, title: "WHOQOL-BREF", description: "Instrumento da OMS para avaliação de qualidade de vida (versão breve).", tags: ["qualidade de vida", "avaliação", "OMS"], author: "Organização Mundial da Saúde", type: "Questionário", accessLevel: "Público", language: "Português", time: 10, version: "1.0", createdAt: "2023-06-18", popularity: 190, link: "#" },
                { id: 12, title: "Escala de Pânico e Agorafobia (EPA)", description: "Avalia a severidade de sintomas relacionados ao transtorno de pânico e agorafobia.", tags: ["ansiedade", "pânico", "agorafobia"], author: "I. Marks & R. Mathews", type: "Escala", accessLevel: "Restrito", language: "Português", time: 15, version: "1.0", createdAt: "2023-07-04", popularity: 88, link: "#" },
            ];

            // --- ELEMENTOS DO DOM ---
            const itemsGrid = document.getElementById('items-grid');
            const noResultsDiv = document.getElementById('no-results');
            const itemCountP = document.getElementById('item-count');
            const searchInput = document.getElementById('search');
            const tagsFilterDiv = document.getElementById('tags-filter');
            const typeFilterSelect = document.getElementById('type-filter');
            const accessFilterSelect = document.getElementById('access-filter');
            const sortBySelect = document.getElementById('sort-by');
            const clearFiltersBtn = document.getElementById('clear-filters');
            const modal = document.getElementById('item-modal');
            const modalCloseBtn = document.getElementById('modal-close');
            
            // --- ESTADO DA APLICAÇÃO ---
            let filters = {
                searchTerm: '',
                selectedTags: new Set(),
                type: 'all',
                access: 'all'
            };

            let sortBy = 'recent';

            // --- FUNÇÕES DE RENDERIZAÇÃO ---

            // Gera o HTML para um único card de instrumento
            const createItemCard = (item) => {
                const tagsHTML = item.tags.map(tag => `<span class="bg-cyan-100 text-cyan-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${tag}</span>`).join(' ');
                
                return `
                    <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 flex flex-col cursor-pointer" data-id="${item.id}">
                        <div class="p-5 flex-grow">
                            <h3 class="text-lg font-bold text-gray-900 mb-2 truncate">${item.title}</h3>
                            <p class="text-gray-600 text-sm mb-4 h-10 overflow-hidden">${item.description}</p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                ${tagsHTML}
                            </div>
                        </div>
                        <div class="px-5 py-3 bg-gray-50 border-t rounded-b-lg flex justify-between items-center text-sm text-gray-500">
                            <div><i class="fas fa-clock mr-1"></i> ${item.time} min</div>
                            <div><i class="fas fa-user-edit mr-1"></i> ${item.author.split(',')[0]}</div>
                        </div>
                    </div>
                `;
            };
            
            // Renderiza todos os cards na tela
            const renderItems = () => {
                // 1. Filtrar
                let filteredItems = instrumentos.filter(item => {
                    const searchMatch = item.title.toLowerCase().includes(filters.searchTerm) || item.description.toLowerCase().includes(filters.searchTerm) || item.author.toLowerCase().includes(filters.searchTerm);
                    const tagsMatch = filters.selectedTags.size === 0 || [...filters.selectedTags].every(tag => item.tags.includes(tag));
                    const typeMatch = filters.type === 'all' || item.type === filters.type;
                    const accessMatch = filters.access === 'all' || item.accessLevel === filters.access;
                    return searchMatch && tagsMatch && typeMatch && accessMatch;
                });

                // 2. Ordenar
                switch (sortBy) {
                    case 'recent':
                        filteredItems.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        break;
                    case 'popular':
                        filteredItems.sort((a, b) => b.popularity - a.popularity);
                        break;
                    case 'time-asc':
                        filteredItems.sort((a, b) => a.time - b.time);
                        break;
                    case 'time-desc':
                        filteredItems.sort((a, b) => b.time - a.time);
                        break;
                    case 'alpha-asc':
                        filteredItems.sort((a, b) => a.title.localeCompare(b.title));
                        break;
                    case 'alpha-desc':
                        filteredItems.sort((a, b) => b.title.localeCompare(a.title));
                        break;
                }
                
                // 3. Limpar e exibir
                itemsGrid.innerHTML = '';
                if (filteredItems.length > 0) {
                    itemsGrid.innerHTML = filteredItems.map(createItemCard).join('');
                    itemsGrid.classList.remove('hidden');
                    noResultsDiv.classList.add('hidden');
                } else {
                    itemsGrid.classList.add('hidden');
                    noResultsDiv.classList.remove('hidden');
                }

                // 4. Atualizar contador
                itemCountP.textContent = `${filteredItems.length} instrumento(s) encontrado(s).`;
            };

            // Renderiza as tags no filtro da sidebar
            const renderTagsFilter = () => {
                const allTags = new Set(instrumentos.flatMap(item => item.tags));
                tagsFilterDiv.innerHTML = [...allTags].sort().map(tag => `
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" class="form-checkbox h-4 w-4 rounded text-cyan-600 focus:ring-cyan-500" data-tag="${tag}">
                        <span class="text-gray-700">${tag}</span>
                    </label>
                `).join('');
            };


            // --- LÓGICA DO MODAL ---
            
            const showModal = (itemId) => {
                const item = instrumentos.find(i => i.id === parseInt(itemId));
                if (!item) return;

                document.getElementById('modal-title').textContent = item.title;
                document.getElementById('modal-author').textContent = item.author;
                document.getElementById('modal-type').textContent = item.type;
                document.getElementById('modal-time').textContent = `${item.time} minutos`;
                document.getElementById('modal-access').textContent = item.accessLevel;
                document.getElementById('modal-description').textContent = item.description;
                document.getElementById('modal-instructions').textContent = "Siga as instruções contidas no manual do teste. A aplicação deve ser realizada por um profissional qualificado. Certifique-se de que o ambiente é silencioso e livre de interrupções."; // Exemplo
                document.getElementById('modal-target').textContent = "Varia conforme o instrumento. Consulte o manual para informações detalhadas sobre a população-alvo apropriada."; // Exemplo

                const modalTagsContainer = document.getElementById('modal-tags');
                modalTagsContainer.innerHTML = item.tags.map(tag => `<span class="bg-gray-200 text-gray-800 text-sm font-medium px-3 py-1 rounded-full">${tag}</span>`).join(' ');

                const openLinkBtn = document.getElementById('modal-open-link-btn');
                openLinkBtn.href = item.link;

                const copyLinkBtn = document.getElementById('modal-copy-link-btn');
                copyLinkBtn.onclick = () => {
                    // Nota: navigator.clipboard.writeText pode não funcionar em todos os contextos (ex: iframe).
                    // Usando um método fallback.
                    const tempInput = document.createElement('input');
                    document.body.appendChild(tempInput);
                    tempInput.value = window.location.origin + window.location.pathname + item.link; // Simula link completo
                    tempInput.select();
                    try {
                        document.execCommand('copy');
                        copyLinkBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Copiado!';
                        setTimeout(() => { copyLinkBtn.innerHTML = '<i class="fas fa-copy mr-2"></i>Copiar Link'; }, 2000);
                    } catch (err) {
                        console.error('Falha ao copiar link: ', err);
                        alert('Não foi possível copiar o link.');
                    }
                    document.body.removeChild(tempInput);
                };

                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('modal-hidden'), 10);
                document.body.style.overflow = 'hidden'; // Evita scroll do fundo
            };

            const hideModal = () => {
                modal.classList.add('modal-hidden');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }, 300);
            };

            // --- EVENT LISTENERS ---

            // Filtro de busca
            searchInput.addEventListener('input', (e) => {
                filters.searchTerm = e.target.value.toLowerCase();
                renderItems();
            });

            // Filtro de tags
            tagsFilterDiv.addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    const tag = e.target.dataset.tag;
                    if (e.target.checked) {
                        filters.selectedTags.add(tag);
                    } else {
                        filters.selectedTags.delete(tag);
                    }
                    renderItems();
                }
            });

            // Filtros de select
            typeFilterSelect.addEventListener('change', (e) => {
                filters.type = e.target.value;
                renderItems();
            });
            accessFilterSelect.addEventListener('change', (e) => {
                filters.access = e.target.value;
                renderItems();
            });

            // Ordenação
            sortBySelect.addEventListener('change', (e) => {
                sortBy = e.target.value;
                renderItems();
            });

            // Limpar filtros
            clearFiltersBtn.addEventListener('click', () => {
                filters = { searchTerm: '', selectedTags: new Set(), type: 'all', access: 'all' };
                sortBy = 'recent';
                
                searchInput.value = '';
                typeFilterSelect.value = 'all';
                accessFilterSelect.value = 'all';
                sortBySelect.value = 'recent';
                document.querySelectorAll('#tags-filter input[type="checkbox"]').forEach(cb => cb.checked = false);
                
                renderItems();
            });
            
            // Abrir modal ao clicar no card
            itemsGrid.addEventListener('click', (e) => {
                const card = e.target.closest('[data-id]');
                if (card) {
                    showModal(card.dataset.id);
                }
            });

            // Fechar modal
            modalCloseBtn.addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });

            // Botão de favorito no modal (simulação)
            const favBtn = document.getElementById('modal-favorite-btn');
            favBtn.addEventListener('click', () => {
                const icon = favBtn.querySelector('i');
                const text = favBtn.querySelector('.favorite-text');
                const isFavorited = icon.classList.contains('fas');

                if (isFavorited) {
                    icon.classList.replace('fas', 'far');
                    text.textContent = 'Favoritar';
                    favBtn.classList.remove('favorited');
                } else {
                    icon.classList.replace('far', 'fas');
                    text.textContent = 'Favoritado';
                    favBtn.classList.add('favorited');
                }
            });


            // --- INICIALIZAÇÃO DA APLICAÇÃO ---
            renderTagsFilter();
            renderItems();

        });
    </script>

</body>
</html>
